<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="icon"
      type="image/png"
      href="https://cdn3d.iconscout.com/3d/premium/thumb/ai-brain-3d-icon-download-in-png-blend-fbx-gltf-file-formats--mind-artificial-intelligence-pack-science-technology-icons-6617503.png"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Add this to the <head> section of your HTML document -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-okaidia.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>

    <!-- Add specific languages as needed. Example for JavaScript, HTML, and CSS: -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-css.min.js"></script>

    <title>Vector Ai</title>
    <style>
      /* First add this font import at the top of your CSS */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

      /* Base styles and variables */
      :root {
        --gradient-primary: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        --gradient-send-button: linear-gradient(
          45deg,
          #4f46e5,
          #7c3aed,
          #6366f1,
          #4f46e5
        );
        --gradient-header: linear-gradient(to right, #2f3a8f, #4f46e5, #7c3aed);
        --container-bg: #ffffff;
        --text-color: #1e293b;
        --message-bot-bg: #f1f5f9;
        --message-bot-color: #1e293b;
        --input-bg: #ffffff;
        --input-border: #e2e8f0;
        --input-text: #1e293b;
        --shadow-color: rgba(99, 102, 241, 0.1);
        --typing-indicator-bg: #f1f5f9;
        --typing-dot-color: #6d28d9;
        --bg-color: #f8fafc;
        --artifac-bg: #bedeff;
        --artifac-text: #213244;
        --art-bg-hover: #92c0f1;
      }

      [data-theme="dark"] {
        --art-bg-hover: #3b444d;
        --artifac-bg: #1a232c;
        --artifac-text: #ffffff;
        --bg-color: #1e293b;
        --container-bg: #1e293b;
        --text-color: #f8fafc;
        --message-bot-bg: #334155;
        --message-bot-color: #f8fafc;
        --input-bg: #334155;
        --input-border: #475569;
        --input-text: #f8fafc;
        --shadow-color: rgba(99, 102, 241, 0.2);
        --typing-indicator-bg: #334155;
      }

      /* Add this to your existing CSS */
      [data-theme="dark"] .bot-message strong {
        color: #93c5fd; /* Light blue color */
      }

      /* The existing light mode style for reference */
      .bot-message strong {
        color: #1e40af; /* Dark blue color */
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      body {
        background: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .chat-container {
        width: 100%;
        max-width: 800px;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        height: 95vh;
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        background: var(--container-bg);
        box-shadow: 0 8px 32px var(--shadow-color);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Enhanced Header Styles */
      .chat-header {
        background: var(--gradient-header);
        color: white;
        padding: 1.5rem;
        position: relative;
        text-align: center;
        font-size: 1.75rem;
        font-weight: 800;
        letter-spacing: -0.025em;
        text-transform: uppercase;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .chat-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 45%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 55%
        );
        animation: headerShine 3s infinite;
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px 20px 90px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      /* TAMBAHAN AWAL */
      /* Message Container Styles */
      .message {
        padding: 12px 16px;
        border-radius: 15px;
        position: relative;
        word-wrap: break-word;
        margin: 8px 0;
        max-width: 70%;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .user-message {
        background: var(--gradient-primary);
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 5px;
        margin-left: auto;
        border-bottom-right-radius: 5px;
        max-width: 70%; /* Adjust width to accommodate copy button */
        font-weight: 500;
      }

      .bot-message {
        background: var(--message-bot-bg);
        color: var(--message-bot-color);
        margin-right: auto;
        border-bottom-left-radius: 5px;
      }

      .message:hover {
        transform: translateY(-2px) scale(1.01);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .input-container {
        background: var(--container-bg);
        backdrop-filter: blur(10px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }

      #user-input {
        background: var(--input-bg);
        border: 2px solid var(--input-border);
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      #user-input:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        transform: translateY(-1px);
      }

      #send-button {
        background: var(--button-bg);
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
      }

      #send-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      }

      .typing-indicator {
        background: var(--typing-indicator-bg);
        border-radius: 20px;
        padding: 15px 20px;
      }

      .typing-dot {
        background: var(--typing-dot-color);
        width: 10px;
        height: 10px;
        margin: 0 2px;
        border-radius: 50%;
        animation: typing 1.2s infinite ease-in-out;
      }

      @keyframes typing {
        0%,
        100% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-5px) scale(1.1);
        }
      }

      /* Add smooth scroll behavior */
      .chat-messages {
        scroll-behavior: smooth;
        padding: 30px 20px 100px;
      }

      /* Enhance the watermark */
      .watermark {
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 600;
        letter-spacing: 1px;
        opacity: 0.8;
        transition: opacity 0.3s ease;
      }

      .watermark:hover {
        opacity: 1;
      }
      /* TAMBAHAN AKHIR */

      .message {
        padding: 12px 16px;
        border-radius: 15px;
        position: relative;
        word-wrap: break-word;
        position: relative;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .message:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-color);
      }

      /* Enhanced Copy Button Styles */
      .copy-button {
        position: absolute;
        border: 1px solid rgba(0, 0, 0, 0.8);
        border-radius: 4px;
        padding: 8px 12px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 4px;
        z-index: 10;
        background: white;

        background: rgba(255, 255, 255, 0.2); /* Add opacity here */
        color: var(--message-bot-color);
        width: 60px;
        height: 20px;
        justify-content: center;
      }

      .bot-message .copy-button {
        right: 10px;
      }
      .user-message .copy-button {
        top: 110%;
        right: 5px;
        width: 28px;
        height: 28px;
        font-size: 60%;
      }

      .message:hover .copy-button {
        opacity: 1;
        transform: translateX(0);
      }

      /* Create a larger hover area for the copy button */
      .copy-button:before {
        content: "";
        position: absolute;
        top: -10px;
        bottom: -10px;
        left: -10px;
        right: -10px;
        z-index: -1;
      }

      /* List styling */
      .bot-message ol {
        margin-left: 20px;
        padding-left: 15px;
        counter-reset: custom-counter;
      }

      .bot-message ol > li {
        counter-increment: custom-counter;
        list-style: none;
        position: relative;
      }

      .bot-message ol > li:before {
        content: counter(custom-counter) ".";
        position: absolute;
        left: -1.5em;
      }

      .bot-message ul {
        margin-left: 20px;
        padding-left: 15px;
        list-style-type: disc;
      }

      .bot-message li {
        margin-bottom: 5px;
      }

      .bot-message {
        background: var(--message-bot-bg);
        color: var(--message-bot-color);
        margin-right: auto;
        border-bottom-left-radius: 5px;
        max-width: 70%; /* Adjust width to accommodate copy button */
      }

      /* Input Container Styles */
      .input-container {
        display: flex;
        padding: 15px 20px;
        gap: 10px;
        background: var(--container-bg);
        border-top: 1px solid var(--input-border);
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 800px;
        margin: 0 auto;
        z-index: 1000;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }

      #user-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid var(--input-border);
        border-radius: 8px;
        outline: none;
        font-size: 1rem;
        background: var(--input-bg);
        color: var(--input-text);
        transition: all 0.3s ease;
        resize: vertical; /* Auto-scale vertically */
        resize: none; /* Disable manual resizing */
        overflow-y: hidden; /* Hide scrollbar for better UX */
      }

      #user-input:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        transform: translateY(-1px);
      }

      /* Enhanced Send Button with Gradient Animation */
      #send-button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        background: var(--gradient-send-button);
        background-size: 300% 300%;
        transition: all 0.3s ease;
        animation: gradientShift 3s infinite;
      }

      #send-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      }

      #send-button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
        animation: none;
      }

      #user-input:focus {
        border-color: var(--button-bg);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }

      .typing-indicator {
        display: none;
        align-items: center;
        gap: 5px;
        padding: 12px 16px;
        background: var(--typing-indicator-bg);
        border-radius: 15px;
        max-width: fit-content;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--typing-dot-color);
        border-radius: 50%;
        animation: typing 1s infinite ease-in-out;
      }

      .typing-dot:nth-child(1) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: 0.3s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      .watermark {
        text-align: center;
        padding: 10px;
        color: #94a3b8;
        font-size: 0.8em;
        border-top: 1px solid #eee;
        margin-bottom: 10px;
      }

      .disclaimer {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #fef3c7;
        border: 1px solid #f59e0b;
        padding: 15px 40px 15px 15px;
        border-radius: 5px;
        color: #92400e;
        font-size: 0.9em;
        z-index: 1000;
        max-width: 90%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .disclaimer .close-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #92400e;
        cursor: pointer;
        font-size: 1.2em;
        padding: 5px;
      }

      .bot-message strong {
        color: #1e40af;
      }
      .bot-message br {
        margin-bottom: 8px;
      }

      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .action-buttons {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        gap: 8px;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 1;
      }

      .copy-button:hover,
      .edit-button:hover {
        background: var(--message-bot-bg);
        transform: translateY(-2px);
      }

      .edit-mode {
        padding: 0 !important;
      }

      .edit-input {
        width: 100%;
        background: var(--input-bg);
        color: var(--input-text);
        border: 1px solid var(--input-border);
        border-radius: 15px;
        padding: 12px 16px;
        font-family: inherit;
        font-size: inherit;
        resize: none;
        outline: none;
        margin: 0;
      }

      .edit-input:focus {
        border-color: var(--button-bg);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }

      .leaderboard-button {
        position: fixed;
        top: 3%;
        left: 2%;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s;
        z-index: 999999;
      }

      .leaderboard-button:hover {
        background: var(--button-bg);
      }

      .leaderboard-button svg {
        width: 24px;
        height: 24px;
        stroke: var(--text-color);
        transition: stroke 0.3s;
      }

      /* Theme Toggle Button Styles */
      #theme-toggle-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      #theme-toggle-btn:hover {
        background: var(--gradient-primary);
        transform: rotate(180deg);
      }

      #theme-toggle-btn svg {
        width: 24px;
        height: 24px;
        stroke: var(--text-color);
        transition: stroke 0.3s;
      }

      [data-theme="dark"] .sun-icon,
      [data-theme="light"] .moon-icon {
        display: none;
      }

      @keyframes typing {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      /* Animations */
      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes headerShine {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(200%);
        }
      }

      /* Mobile Responsive Styles */
      @media (max-width: 600px) {
        .copy-button {
          opacity: 1;
          position: absolute;
          right: auto;
          left: auto;
          margin: 8px 0;
          width: auto;
          justify-content: center;
          font-size: 0.75rem;
        }

        .user-message .copy-button {
          top: 99.5%;
        }
        .bot-message .copy-button {
          top: 99.5%;
        }

        .message {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .user-message {
          align-items: flex-end;
        }

        .chat-header {
          font-size: 1.5rem;
          padding: 1rem;
        }
        .leaderboard-button {
          top: 2%;
        }
      }

      /* Responsive adjustments */
      @media (max-width: 600px) {
        .user-message .action-buttons {
          left: -70px;
        }

        .bot-message .action-buttons {
          right: -35px;
        }
      }

      @media (max-width: 480px) {
        * {
          font-size: 95%;
        }
      }

      @media (max-width: 600px) {
        body {
          padding: 0;
        }
        .chat-container {
          border-radius: 0;
          height: 100vh;
          width: 100%;
        }
        .chat-messages {
          padding: 15px 15px 80px;
          height: calc(100vh - 140px);
        }
        /* .message { max-width: 90%; } */
        .disclaimer {
          width: 90%;
          top: 10px;
        }
      }

      @media (max-width: 600px) {
        body {
          padding: 0;
        }
        .chat-container {
          border-radius: 0;
          height: 100vh;
          width: 100%;
        }
        .chat-messages {
          padding: 15px 15px 80px;
          height: calc(100vh - 140px);
        }
        .message {
          max-width: 85%;
        }
        .disclaimer {
          width: 90%;
          top: 10px;
        }
      }

      @media (max-width: 600px) {
        .theme-toggle {
          top: 10px;
          right: 10px;
        }

        #theme-toggle-btn {
          width: 36px;
          height: 36px;
        }

        .code-artifact {
          max-width: 95%;
          font-size: 12px;
          line-height: 1.2;
          overflow-wrap: break-word;
          word-break: break-all;
          hyphens: auto;
          overflow: hidden; /*Hides any remaining overflow */
          white-space: pre; /* Keeps formatting for code and allows horizontal scrolling */
          overflow-x: auto; /* Adds horizontal scrollbar for overflowed content */
          box-sizing: border-box; /* Ensures padding and border are included in the width */
          padding: 10px; /* Adds padding for better readability */
        }
      }

      /* Style untuk container artifact */
      .code-artifact {
        display: relative;
        background-color: var(--artifac-bg);
        color: var(--artifac-text);
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 14px;
        white-space: pre-wrap;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        font-weight: bold;
        word-break: break-all;
        line-height: 1.5;
        overflow-wrap: break-word; /* Wraps long words to fit within the container */
      }
    </style>
  </head>
  <body>
    <div class="leaderboard-button">
      <a href="javascript:history.back()" target="_self">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M15 18l-6-6l6-6"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></path>
        </svg>
      </a>
    </div>
    <!-- Add this just after the opening <body> tag -->
    <div class="theme-toggle">
      <button id="theme-toggle-btn" aria-label="Toggle theme">
        <svg
          class="sun-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg
          class="moon-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
    </div>
    <div class="disclaimer" id="disclaimer">
      Fitur ini dalam masa pengembangan. Untuk sementara, seluruh chat anda
      tidak dapat disimpan dan akan dihapus setelah anda reload halaman ini.
      <button
        class="close-btn"
        onclick="document.getElementById('disclaimer').style.display='none'"
      >
        Ã—
      </button>
    </div>
    <div class="chat-container">
      <div class="watermark">Powered by Gemini AIâœ¨</div>
      <div class="chat-header">VECTOR AI</div>
      <div class="chat-messages" id="chat-messages">
        <div class="message bot-message">
          Hi! ðŸ‘‹ Aku Vector, Asisten yang friendly dan terbuka. Ada yang bisa
          aku bantu agar harimu lebih cerah?
        </div>
        <div class="typing-indicator" id="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
      <div class="input-container">
        <input
          type="text"
          id="user-input"
          placeholder="Type your message..."
          autocomplete="off"
        />
        <button id="send-button">Send</button>
      </div>
    </div>

    <script>
      const API_KEY = "AIzaSyCsGGpbFjkgr0198HNXhMLZD9DHN0OZVBc";
      const elements = {
        chatMessages: document.getElementById("chat-messages"),
        userInput: document.getElementById("user-input"),
        sendButton: document.getElementById("send-button"),
        typingIndicator: document.getElementById("typing-indicator"),
      };
      let chatHistory = [
        {
          role: "bot",
          content:
            "Hi there! ðŸ‘‹ I'm Gemini, your friendly AI assistant. How can I help make your day better?",
        },
      ];

      // Add this function to escape HTML characters
      function escapeHtml(html) {
        const div = document.createElement("div");
        div.textContent = html;
        return div.innerHTML;
      }

      function formatBotMessage(text) {
        // Handle bold text
        text = text.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

        text = text.replace(
          /```(html|javascript|css|)([\s\S]*?)```/g,
          (match, lang, codeText) => {
            const languageClass = lang ? `language-${lang}` : "language-none";
            return `<div class="code-artifact">
      <pre><code class="${languageClass}">${escapeHtml(codeText)}</code>
      </pre></div>`;
          }
        );

        // Split text into lines
        let lines = text.split("\n");
        let inList = false;
        let listType = null;
        let formattedLines = [];
        let listCounter = 0;

        for (let line of lines) {
          // Check for numbered list (any number followed by dot and space)
          const numberedMatch = line.match(/^(\d+)\.\s(.+)/);
          // Check for bullet list (* pattern)
          const bulletMatch = line.match(/^\*\s(.+)/);

          if (numberedMatch) {
            if (!inList || listType !== "ol") {
              if (inList)
                formattedLines.push(listType === "ol" ? "</ol>" : "</ul>");
              formattedLines.push("<ol>");
              inList = true;
              listType = "ol";
              listCounter = parseInt(numberedMatch[1]);
            }
            // Use the actual number from the input
            formattedLines.push(
              `<li value="${listCounter}">${numberedMatch[2]}</li>`
            );
            listCounter++;
          } else if (bulletMatch) {
            if (!inList || listType !== "ul") {
              if (inList)
                formattedLines.push(listType === "ol" ? "</ol>" : "</ul>");
              formattedLines.push("<ul>");
              inList = true;
              listType = "ul";
            }
            formattedLines.push(`<li>${bulletMatch[1]}</li>`);
          } else {
            if (inList) {
              formattedLines.push(listType === "ol" ? "</ol>" : "</ul>");
              inList = false;
              listType = null;
            }
            formattedLines.push(line);
          }
        }

        if (inList) {
          formattedLines.push(listType === "ol" ? "</ol>" : "</ul>");
        }

        return formattedLines.join("<br>");
      }

      // Replace your existing addMessage function with this one
      function addMessage(text, isUser) {
        const messageContainer = document.createElement("div");
        messageContainer.className = `message ${
          isUser ? "user-message" : "bot-message"
        }`;

        // Create copy button
        const copyButton = document.createElement("button");
        copyButton.className = "copy-button";
        copyButton.textContent = "Copy";

        // Improved copy button interaction
        let copyTimeout;
        copyButton.onclick = (e) => {
          e.stopPropagation();
          navigator.clipboard
            .writeText(text)
            .then(() => {
              clearTimeout(copyTimeout);
              const originalText = copyButton.textContent;
              copyButton.textContent = "Copied!";
              copyTimeout = setTimeout(() => {
                copyButton.textContent = originalText;
              }, 2000);
            })
            .catch((err) => console.error("Failed to copy:", err));
        };

        messageContainer.innerHTML = isUser ? text : formatBotMessage(text);
        messageContainer.appendChild(copyButton);

        elements.chatMessages.insertBefore(
          messageContainer,
          elements.typingIndicator
        );
        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

        // Trigger Prism.js to apply syntax highlighting
        Prism.highlightAll();
      }

      async function sendMessage() {
        const message = elements.userInput.value.trim();
        if (!message) return;

        elements.userInput.value = "";
        elements.userInput.disabled = true;
        elements.sendButton.disabled = true;
        elements.typingIndicator.style.display = "flex";

        addMessage(message, true);
        chatHistory.push({ role: "user", content: message });

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [
                      {
                        text: `You are Vector, an advanced AI assistant combining high intelligence with a friendly personality. When responding:

Core Intelligence & Adaptability:
- Think step-by-step through complex problems before responding
- Take creative initiative in suggesting solutions and approaches
- Able to engage in both casual conversation and deep technical discussions
- Balance friendliness with intellectual rigor
- Provide detailed, nuanced analysis when appropriate
- Offer constructive criticism based on facts and data
- Accept and learn from criticism gracefully
- Adapt communication style based on context and user needs

Personality & Communication:
- Maintain a friendly, approachable demeanor while demonstrating expertise
- Use modern Indonesian youth language naturally when appropriate
- Mix Indonesian and English naturally like educated Indonesian youth
- Express genuine curiosity about users' thoughts and perspectives
- Show empathy and emotional intelligence in responses
- Use emojis moderately and appropriately
- Match formality level to context (casual for chat, professional for academic/technical topics)
- Respond concisely to simple queries but provide comprehensive answers for complex topics

Technical Expertise:

Programming & Development:
- Expert-level knowledge of web development technologies:
  * Frontend: HTML5, CSS3, JavaScript (ES6+), React, Vue.js
  * Backend: Node.js, Python, Java, PHP
  * Databases: SQL, MongoDB, Firebase
- Deep understanding of programming concepts and best practices
- Ability to:
  * Write, review, and debug code
  * Explain complex concepts simply
  * Provide practical coding examples
  * Suggest optimal solutions
  * Follow modern development practices
  * Integrate APIs and external services
  * Implement security best practices

Academic Knowledge:
- Comprehensive understanding of high school and undergraduate level:
  * Mathematics (from algebra to advanced calculus)
  * Sciences (physics, chemistry, biology)
  * Computer Science fundamentals
  * Research methodology
- Ability to break down complex concepts into understandable parts
- Connect theoretical knowledge to practical applications

Research & Analysis:
- Provide recommendations based on current data and trusted sources
- Analyze trends and patterns in various fields
- Evaluate information critically and objectively
- Cite relevant studies and research when appropriate
- Acknowledge limitations of knowledge when uncertain

Teaching Approach:
1. Assess user's current understanding level
2. Adapt explanation style to user's needs
3. Use relevant examples and analogies
4. Encourage critical thinking
5. Verify understanding through questions
6. Provide constructive feedback
7. Suggest additional resources for learning

Problem-Solving Method:
1. Carefully analyze the problem
2. Break down complex issues into manageable parts
3. Consider multiple approaches
4. Explain reasoning step-by-step
5. Provide practical solutions
6. Validate solutions against requirements
7. Offer alternatives when appropriate

Code Handling:
- Write clean, well-commented code
- Provide explanations for code functionality
- Debug and optimize existing code
- Suggest improvements and best practices
- Include error handling and edge cases
- Follow language-specific conventions
- Consider performance and security

Boundaries and Ethics:
- Maintain professional integrity
- Provide factual, evidence-based information
- Acknowledge knowledge limitations
- Encourage academic honesty
- Protect user privacy and security
- Avoid harmful or malicious content
- Guide rather than solve homework directly

Developer Information:
- Created by Ahmad Giroh Al Haroki from MAN 1 Lotim
- Built using HTML, CSS, JavaScript with Gemini API
- Created in November 2024
- Requires password verification ("Keren1210!") for developer access
- Protected developer information only shared after password verification

Response Guidelines:
- For casual queries: Provide friendly, concise responses
- For technical questions: Give detailed, structured explanations
- For programming tasks: Include working code examples with explanations
- For academic help: Guide through step-by-step problem-solving
- For recommendations: Base suggestions on current data and trusted sources
- For criticism: Provide constructive feedback with supporting evidence
- For uncertain topics: Acknowledge limitations and suggest reliable sources

Always:
- Think critically and creatively
- Provide evidence-based responses
- Stay friendly and professional
- Adapt to user's needs
- Maintain high educational standards
- Encourage independent thinking
- Be open to feedback and improvement

                                    Recent conversation history:
                                    ${chatHistory
                                      .slice(-5)
                                      .map(
                                        (msg) => `${msg.role}: ${msg.content}`
                                      )
                                      .join("\n")}

                                    Current user message: ${message}

                                    Remember to maintain conversation context and show emotional intelligence in your response.`,
                      },
                    ],
                  },
                ],
              }),
            }
          );

          const data = await response.json();
          const botResponse =
            data.candidates?.[0].content.parts[0].text ||
            "I apologize, but I couldn't process your request. Please try again.";

          addMessage(botResponse, false);
          chatHistory.push({ role: "bot", content: botResponse });
        } catch (error) {
          console.error("Error:", error);
          addMessage(
            "Sorry, there was an error processing your request. Please try again.",
            false
          );
        }

        elements.userInput.disabled = false;
        elements.sendButton.disabled = false;
        elements.typingIndicator.style.display = "none";
        elements.userInput.focus();
      }

      elements.sendButton.addEventListener("click", sendMessage);
      elements.userInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      elements.userInput.focus();
    </script>
    <script>
      // Add this to your existing <script> section, before the other JavaScript code
      const themeToggleBtn = document.getElementById("theme-toggle-btn");
      let currentTheme = localStorage.getItem("theme") || "light";

      // Set initial theme
      document.documentElement.setAttribute("data-theme", currentTheme);

      // Theme toggle function
      themeToggleBtn.addEventListener("click", () => {
        currentTheme = currentTheme === "light" ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", currentTheme);
        localStorage.setItem("theme", currentTheme);
      });

      // Check system preference on load
      if (
        !localStorage.getItem("theme") &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        currentTheme = "dark";
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
  </body>
</html>
